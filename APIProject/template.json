{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Resources": {
        "CloudFrontDistribution": {
            "Type": "AWS::CloudFront::Distribution",
            "DependsOn": "HostingBucket",
            "Properties": {
                "DistributionConfig": {
                    "Enabled": true,
                    "DefaultCacheBehavior": {
                        "AllowedMethods": [
                            "GET",
                            "HEAD"
                        ],
                        "Compress": true,
                        "TargetOriginId": "website-origin",
                        "ViewerProtocolPolicy": "redirect-to-https",
                        "ForwardedValues": {
                            "QueryString": "false"
                        }
                    },
                    "Origins": [
                        {
                            "DomainName": "thecarmelkamaaina.s3-us-west-2.amazonaws.com",
                            "Id": "website-origin",
                            "S3OriginConfig":{
                                "OriginAccessIdentity": ""
                            }
                        }
                    ],
                    "DefaultRootObject": "index.html"
                }
            }
        },
        "HostingBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "AccessControl": "Private",
                "BucketName": "thecarmelkamaaina"
            }
        },
        "RecipesTable": {
            "Type": "AWS::DynamoDB::GlobalTable",
            "Properties": {
                "TableName": "carmel-recipes",
                "BillingMode": "PROVISIONED",
                "KeySchema": [
                    {
                        "AttributeName": "recipeId",
                        "KeyType": "HASH"
                    }
                ],
                "AttributeDefinitions": [
                    {
                        "AttributeName": "recipeId",
                        "AttributeType": "S"
                    },
                    {
                        "AttributeName": "searchIndex",
                        "AttributeType": "S"
                    }
                ],
                "Replicas": [ 
                    {
                        "Region": "us-west-2",
                        "GlobalSecondaryIndexes": [ 
                            {
                                "IndexName": "searchIndex",
                                "ReadProvisionedThroughputSettings": {
                                    "ReadCapacityAutoScalingSettings": {
                                        "MaxCapacity" : 5,
                                        "MinCapacity" : 1,
                                        "TargetTrackingScalingPolicyConfiguration" : {
                                            "TargetValue" : 75.0
                                        }
                                    }
                                }
                            }
                        ],
                        "ReadProvisionedThroughputSettings" : {
                            "ReadCapacityAutoScalingSettings": {
                                "MaxCapacity" : 5,
                                "MinCapacity" : 1,
                                "TargetTrackingScalingPolicyConfiguration" : {
                                    "TargetValue" : 75.0
                                }
                            }
                        }
                    }
                ],
                "WriteProvisionedThroughputSettings": {
                    "WriteCapacityAutoScalingSettings": {
                        "MaxCapacity" : 1,
                        "MinCapacity" : 5,
                        "TargetTrackingScalingPolicyConfiguration" : {
                            "TargetValue" : 75.0
                        }
                    }
                }
            }
        }
    }
}